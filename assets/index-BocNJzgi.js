import{Y,R as B,d as J,c as f,w as de,E as L,H as Q,a4 as X,x as Z,s as T,l as R,u as $,G as ee,e as te,r as E,o as ue,a as W,C as me,k as q,m as fe,D as pe,y as ve}from"./vue.esm-bundler-C43JrhH2.js";import{m as ge,u as oe}from"./index-D5bIuBCX.js";import{b as A,d as O,c as he,w as ye}from"./install-CfJGiCvs.js";import{c as k,u as Fe,b as H}from"./index-DH2w0SzE.js";import{d as we}from"./error-Cq9Fpw4b.js";import{S as Ve}from"./index-CRx4dHSJ.js";import{g as M}from"./ConfigProvider-Br84NlF7.js";import{r as Ie}from"./index-DmfABaPz.js";const re=Symbol("formContextKey"),U=Symbol("formItemContextKey"),be=A({disabled:Boolean}),Se=A({...be,model:Object,rules:{type:O(Object)},validateOnRuleChange:{type:Boolean,default:!0},scrollToError:Boolean,scrollIntoViewOptions:{type:[Object,Boolean]}}),Ce={validate:(d,v,t)=>(Y(d)||B(d))&&ge(v)&&B(t)},_=(d,v)=>{const t=k(v);return t.length>0?d.filter(a=>a.prop&&t.includes(a.prop)):d},xe="GForm",se=J({name:xe,__name:"Form",props:Se,emits:Ce,setup(d,{expose:v,emit:t}){const a=d,p=t,l=[],g=oe("form"),u=o=>l.find(r=>r.prop===o),S=o=>{l.push(o)},c=o=>{o.prop&&l.splice(l.indexOf(o),1)},V=(o=[])=>{a.model&&_(l,o).forEach(r=>r.resetField())},I=(o=[])=>{_(l,o).forEach(r=>r.clearValidate())},w=f(()=>!!a.model),j=o=>{if(l.length===0)return[];const r=_(l,o);return r.length?r:[]},C=async o=>h(void 0,o),b=async(o=[])=>{if(!w.value)return!1;const r=j(o);if(r.length===0)return!0;let m={};for(const n of r)try{await n.validate(""),n.validateState==="error"&&n.resetField()}catch(y){m={...m,...y}}return Object.keys(m).length===0?!0:Promise.reject(m)},h=async(o=[],r)=>{const m=!ee(r);try{const n=await b(o);return n===!0&&await r?.(n),n}catch(n){if(n instanceof Error)throw n;const y=n;return a.scrollToError&&x(Object.keys(y)[0]),await r?.(!1,y),m&&Promise.reject(y)}},x=o=>{const r=_(l,o)[0];r&&r.$el?.scrollIntoView(a.scrollIntoViewOptions)};return de(()=>a.rules,()=>{a.validateOnRuleChange&&C().catch(o=>we())},{deep:!0,flush:"post"}),L(re,Q({...X(a),emit:p,resetFields:V,clearValidate:I,validateField:h,getField:u,addField:S,removeField:c})),v({validate:C,validateField:h,resetFields:V,clearValidate:I,scrollToField:x,fields:l}),(o,r)=>(te(),Z("form",{class:R($(g).b())},[T(o.$slots,"default")],2))}});se.__docgenInfo={exportName:"default",displayName:"Form",description:"",tags:{},expose:[{name:"validate",tags:[{title:"description",content:"Validate the whole form. Receives a callback or returns `Promise`."}]},{name:"validateField",tags:[{title:"description",content:"Validate specified fields."}]},{name:"resetFields",tags:[{title:"description",content:"Reset specified fields and remove validation result."}]},{name:"clearValidate",tags:[{title:"description",content:"Clear validation message for specified fields."}]},{name:"scrollToField",tags:[{title:"description",content:"Scroll to the specified fields."}]},{name:"fields",tags:[{title:"description",content:"All fields context."}]}],slots:[{name:"default"}],sourceFiles:["/home/runner/work/global-design-system/global-design-system/components/form/src/Form.vue"]};const Ee=A({prop:{type:O([String,Array])},rules:{type:O([Object,Array])},showMessage:{type:O(String),default:"child"}}),G=J({name:"FormItem",__name:"form-item",props:Ee,setup(d,{expose:v}){const t=d,a=W(re,void 0);W(U,void 0);const p=oe("form-item"),l=Fe().value,g=E([]),u=E(""),S=Ie(u,100),c=E(""),V=E();let I,w=!1;const j=f(()=>[p.b(),p.is("error",u.value==="error"),p.is("validating",u.value==="validating"),p.is("success",u.value==="success")]),C=f(()=>t.prop?B(t.prop)?t.prop:t.prop.join("."):""),b=f(()=>{const e=a?.model;if(!(!e||!t.prop))return M(e,t.prop).value}),h=f(()=>{const e=[];t.rules&&e.push(...k(t.rules));const s=a?.rules;if(s&&t.prop){const i=M(s,t.prop).value;i&&e.push(...k(i))}return e}),x=f(()=>h.value.length>0),o=e=>h.value.filter(i=>!i.trigger||!e?!0:Y(i.trigger)?i.trigger.includes(e):i.trigger===e).map(({trigger:i,...F})=>F);f(()=>h.value.some(e=>e.required));const r=f(()=>S.value==="error"&&t.showMessage==="parent"),m=f(()=>S.value==="error"&&t.showMessage==="child"),n=e=>{u.value=e},y=e=>{const{errors:s,fields:i}=e;(!s||!i)&&console.error(e),n("error"),c.value=s?s?.[0]?.message??`${t.prop} es requerido`:"",a?.emit("validate",t.prop,!1,c.value)},ae=()=>{n("success"),c.value="",a?.emit("validate",t.prop,!0,"")},ne=async e=>{const s=C.value;return new Ve({[s]:e}).validate({[s]:b.value},{firstFields:!0}).then(()=>(ae(),!0)).catch(F=>(y(F),Promise.reject(F)))},D=async(e,s)=>{if(w||!t.prop)return!1;const i=ee(s);if(!x.value)return s?.(!1),!1;const F=o(e);return F.length===0?(s?.(!0),!0):(n("validating"),ne(F).then(()=>(s?.(!0),!0)).catch(ce=>{const{fields:z}=ce;return s?.(!1,z),i?!1:Promise.reject(z)}))},N=()=>{n(""),c.value="",w=!1},K=async()=>{const e=a?.model;if(!e||!t.prop)return;const s=M(e,t.prop);w=!0,s.value=H(I),await pe(),N(),w=!1},ie=e=>{g.value.includes(e)||g.value.push(e)},le=e=>{g.value=g.value.filter(s=>s!==e)},P=Q({...X(t),$el:V,validateState:u,inputIds:g,labelId:l,fieldValue:b,shouldShowError:r,shouldShowErrorChild:m,validateMessage:c,addInputId:ie,removeInputId:le,resetField:K,clearValidate:N,validate:D});return L(U,P),ue(()=>{t.prop&&(a?.addField(P),I=H(b.value))}),me(()=>{a?.removeField(P)}),v({validateMessage:c,shouldShowError:r,shouldShowErrorChild:m,validateState:u,validate:D,clearValidate:N,resetField:K}),(e,s)=>(te(),Z("div",{ref_key:"formItemRef",ref:V,class:R(j.value)},[T(e.$slots,"default"),q("div",{class:R({[$(p).e("content-error")]:r.value})},[r.value?T(e.$slots,"error",{key:0,error:c.value},()=>[q("span",{class:R($(p).e("error"))},ve(c.value),3)]):fe("",!0)],2)],2))}});G.__docgenInfo={name:"FormItem",exportName:"default",displayName:"form-item",description:"",tags:{},expose:[{name:"validateMessage",tags:[{title:"description",content:"Validation message."}]},{name:"shouldShowError",tags:[{title:"description",content:"Whether to show error message in form item."}]},{name:"shouldShowErrorChild",tags:[{title:"description",content:"Whether to show error message in the child of form item."}]},{name:"validateState",tags:[{title:"description",content:"Validation state."}]},{name:"validate",tags:[{title:"description",content:"Validate form item."}]},{name:"clearValidate",tags:[{title:"description",content:"Remove validation status of the field."}]},{name:"resetField",tags:[{title:"description",content:"Reset current field and remove validation result."}]}],slots:[{name:"default"},{name:"error",scoped:!0,bindings:[{name:"error",title:"binding"}]}],sourceFiles:["/home/runner/work/global-design-system/global-design-system/components/form/src/form-item.vue"]};const Te=ye(se,{FormItem:G}),$e=he(G);export{$e as G,Te as a};
